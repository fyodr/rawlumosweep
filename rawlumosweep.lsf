################################################################################
# rawlumosweep.lsf
# by Ted Morin
#
# script to run a 
# bend Radius And Width LUmerical MOde solutions SWEEP
#
# the following are recorded in an output csv file:
#
# inputs:
# - see rawlumosweep_inputs.lsf.example
#
# outputs:
# - see rawlumosweep_outputs.lsf
################################################################################

clear;
# define inputs
rawlumosweep_inputs;
# define the get_material_from_file function
material_from_file;
# set up model geometry
rawlumosweep_setup;
# define output_header and the write_output function
rawlumosweep_output;

################################################################################
## sweep preparation

mode_found = 0;

# write a header to the output file
write(output_filename, output_header); 
# output_filename is defined in rawlumosweep_inputs.lsf
# output_header   is defined in rawlumosweep_output.lsf

################################################################################
## sweep proper

for (ii=1:total_num_steps) {

    # set the variables for this iteration
    inp.lambda = lambdas(ii);
    inp.wg_width = wg_widths(ii);
    inp.bend_radius = bend_radii(ii);
    inp.wg_height = wg_heights(ii);
    inp.etch_depth = etch_depths(ii);
    inp.sidewall_angle = sidewall_angles(ii);

    inp.sim_dx = sim_dxs(ii);
    inp.sim_dy = sim_dys(ii);
    inp.sim_width = sim_widths(ii);
    inp.sim_height = sim_heights(ii);

    # update the simulation geometry
    rawlumosweep_update;

    # run the simulation
    rawlumosweep_run;

} # loop end
print("Done!");

################################################################################
## cleanup

# remove dcard
#cleardcard("target_mode_dcard");

################################################################################
## immediate plotting/analysis

# NONE CURRENTLY IMPLEMENTED

